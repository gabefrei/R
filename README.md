# GET & STORE MySQL data in R via ssh tunnel on MacOS

## I. Prepare the environemnt

Set up the `ssh` pathway by port forwarding (meaning to point the localhost to mysql server via ssh tunnel)

### Requirements:

1. server\_users
2. server\_ip
3. unused\_local\_port
4. port\_of\_mysql\_server (default : 3306)

### Generate ssh key so that when R connect to the system, the server will let it pass without asking for password

`ssh-keygen -t rsa`

**Do not** make a passphrase; otherwise you'll regret it. The `system` command on R does not accept input for either passphrase or password needed either by ssh or the server. So, be careful!

``` # This will help copy the key generated by the above command to the remoteserver
ssh-copy-id <server_user>@<server_ip>
```
or you can use the following line

```cat ~/.ssh/id\_rsa.pub | ssh \<server\_user\>@\<server\_ip\> "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized\_keys"
``` 

__Please rrefer to [this link](1) for more extensive steps on `ssh-keygen`__

Now you're all set to connect to the MySQL via R

## II. Connect to MySQL server through ssh tunnel in R

Fire up your R and enter the following command:

`system('ssh -f <server_user@server_ip> -L <unused_local_port>:127.0.0.1:<port_of_mysql_server> -N')`

Tips: Unless you're planning to stay on the server to play around here and there, you might want to set it so that the ssh connection will automatically close once you get everything stored in some R objects, use the following command instead:

`system('ssh -f <server_user@server_ip -L <unused_local_port>:127.0.0.1:<port_of_mysql_server> sleep 30')`

This will allow give your connection __30s__ before the connection to the mysql over ssh is closed. Obviously, you can play with the `sleep 30` and put there the number of seconds you think your system needs.

If all goes well, then now you can connect to your MySQL server to get what you need

`data <- dbConnect(MySQL(), ...)`

Hope this will help anyone that has a need for it.

[1]("https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys--2")
